<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BaLapak - Lapak Lokal Urang Banua</title>
    <meta name="description" content="Platform jual beli barang bekas dan sewa hunian di Kalimantan Selatan">
    <link rel="icon" type="image/png" href="logo&fav.png">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Pinterest-Like Component - Light Minimal Theme */
        :root {
            --color-primary: #3B82F6;
            /* Blue accent */
            --color-text: #1F2937;
            /* Black text */
            --color-text-secondary: #6B7280;
            /* Gray text */
            --color-bg: #FFFFFF;
            /* White background */
            --color-bg-page: #FFFFFF;
            /* White page background */
            --color-border: #E5E7EB;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--color-bg-page);
            color: var(--color-text);
        }

        .navbar-sticky {
            position: sticky;
            top: 0;
            z-index: 50;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--color-border);
        }

        .mobile-sticky-header {
            position: sticky;
            top: 0;
            z-index: 50;
            background-color: #FFFFFF;
        }

        @media (min-width: 768px) {
            .mobile-sticky-header {
                position: static;
                background-color: transparent;
            }
        }

        /* Masonry Grid Layout - Responsive with Consistent Gap */
        .masonry-grid {
            column-count: 2;
            column-gap: 16px;
            /* Consistent gap */
        }

        @media (min-width: 640px) {
            .masonry-grid {
                column-count: 2;
                column-gap: 16px;
            }
        }

        @media (min-width: 768px) {
            .masonry-grid {
                column-count: 3;
                column-gap: 16px;
            }
        }

        @media (min-width: 1024px) {
            .masonry-grid {
                column-count: 4;
                column-gap: 16px;
            }
        }

        .product-card {
            background-color: var(--color-bg);
            border-radius: 12px;
            /* Rounded-xl */
            margin-bottom: 16px;
            /* Match gap */
            break-inside: avoid;
            transition: box-shadow 0.2s ease;
            /* Light transition */
            cursor: pointer;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.04);
            /* Soft shadow */
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .product-card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
            /* Shadow increase on hover */
        }

        .product-card:hover::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.015);
            /* Slight overlay */
            pointer-events: none;
        }

        .product-card-image {
            width: 100%;
            height: auto;
            display: block;
            object-fit: cover;
        }

        .product-card-content {
            padding: 16px;
        }

        .product-card-placeholder {
            width: 100%;
            min-height: 200px;
            /* No fixed height */
            aspect-ratio: 3/4;
            /* Natural ratio */
            background-color: #F9FAFB;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: #D1D5DB;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
        }

        .btn-primary:hover {
            background-color: #2563EB;
            transform: scale(1.05);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
            padding: 10px 22px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
        }

        .btn-secondary:hover {
            background-color: var(--color-primary);
            color: white;
        }

        .filter-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid var(--color-border);
            background-color: var(--color-bg);
            color: var(--color-text);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            background-color: var(--color-bg-secondary);
        }

        .filter-btn.active {
            background-color: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background-color: var(--color-bg-secondary);
            color: #6B7280;
        }

        .price-tag {
            color: var(--color-text);
            font-size: 16px;
            font-weight: 700;
            margin-top: 8px;
        }

        .image-gallery {
            margin-bottom: 24px;
        }

        .main-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid var(--color-border);
            margin-bottom: 12px;
        }

        .thumbnail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
        }

        .thumbnail {
            width: 100%;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            border: 2px solid var(--color-border);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .thumbnail:hover {
            border-color: var(--color-primary);
            opacity: 0.8;
        }

        .thumbnail.active {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        /* Minimal fade-in - no heavy animation */
        .fade-in {
            animation: fadeIn 0.15s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .search-input {
            width: 100%;
            padding: 14px 20px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            color: var(--color-text);
            background-color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .search-input::placeholder {
            color: #9CA3AF;
        }

        .filter-input {
            padding: 10px 16px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            font-size: 14px;
            color: var(--color-text);
            background-color: white;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .filter-select {
            padding: 10px 16px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            font-size: 14px;
            color: var(--color-text);
            background-color: white;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .filter-pill {
            padding: 8px 16px;
            border-radius: 50px;
            border: 1px solid var(--color-border);
            background-color: white;
            color: var(--color-text);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .filter-pill:hover {
            border-color: var(--color-primary);
        }

        .filter-pill.active {
            background-color: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .filter-container {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .filter-container::-webkit-scrollbar {
            display: none;
        }

        @media (min-width: 768px) {
            .filter-container {
                flex-wrap: wrap;
                overflow-x: visible;
            }
        }

        /* Filter Modal / Bottom Sheet */
        .filter-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .filter-backdrop.active {
            display: block;
            opacity: 1;
        }

        .filter-modal {
            position: fixed;
            background-color: white;
            z-index: 101;
            transition: transform 0.3s ease;
        }

        /* Mobile: Bottom Sheet */
        @media (max-width: 767px) {
            .filter-modal {
                bottom: 0;
                left: 0;
                right: 0;
                max-height: 80vh;
                border-radius: 20px 20px 0 0;
                transform: translateY(100%);
            }

            .filter-modal.active {
                transform: translateY(0);
            }
        }

        /* Desktop: Side Panel */
        @media (min-width: 768px) {
            .filter-modal {
                top: 0;
                right: 0;
                bottom: 0;
                width: 400px;
                transform: translateX(100%);
            }

            .filter-modal.active {
                transform: translateX(0);
            }
        }

        .filter-modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-modal-content {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(80vh - 140px);
        }

        @media (min-width: 768px) {
            .filter-modal-content {
                max-height: calc(100vh - 140px);
            }
        }

        .filter-modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--color-border);
            display: flex;
            gap: 12px;
        }

        .filter-section {
            margin-bottom: 24px;
        }

        .filter-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 12px;
        }

        .filter-option {
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid var(--color-border);
            background-color: white;
            color: var(--color-text);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 8px;
            display: block;
            width: 100%;
            text-align: left;
        }

        .filter-option:hover {
            border-color: var(--color-primary);
        }

        .filter-option.active {
            background-color: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .filter-price-inputs {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .filter-price-input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            font-size: 14px;
        }

        .filter-price-input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .filter-checkbox-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-checkbox-item:hover {
            border-color: var(--color-primary);
            background-color: #F9FAFB;
        }

        .filter-checkbox-item.active {
            border-color: var(--color-primary);
            background-color: #EFF6FF;
        }

        .filter-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
            accent-color: var(--color-primary);
        }

        .filter-error {
            color: #EF4444;
            font-size: 12px;
            margin-top: 4px;
        }

        .btn-filter {
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid var(--color-border);
            background-color: white;
            color: var(--color-text);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-filter:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .btn-reset {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--color-border);
            background-color: white;
            color: var(--color-text);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-apply {
            flex: 2;
            padding: 12px;
            border-radius: 8px;
            border: none;
            background-color: var(--color-primary);
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-apply:hover {
            background-color: #2563EB;
        }

        .btn-filter-icon {
            width: 48px;
            height: 48px;
            min-width: 48px;
            border-radius: 8px;
            border: 1px solid var(--color-border);
            background-color: white;
            color: var(--color-text);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-filter-icon:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .search-filter-container {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .filter-chips-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .filter-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background-color: #F3F4F6;
            color: var(--color-text);
            border-radius: 50px;
            font-size: 13px;
            font-weight: 500;
        }

        .filter-chip-close {
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            color: #6B7280;
            transition: color 0.2s ease;
        }

        .filter-chip-close:hover {
            color: var(--color-text);
        }

        .filter-chip-reset {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            background-color: transparent;
            color: var(--color-primary);
            border: 1px solid var(--color-primary);
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-chip-reset:hover {
            background-color: var(--color-primary);
            color: white;
        }

        /* Featured Section */
        .featured-section {
            background-color: #1a1a1a;
            color: white;
            padding: 16px 0;
        }

        .featured-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
        }

        .featured-hero {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
        }

        .featured-hero-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.3s ease;
        }

        .featured-hero-placeholder {
            width: 100%;
            height: 100%;
            background-color: #2a2a2a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
        }

        .featured-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background-color: var(--color-primary);
            color: white;
            padding: 6px 14px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            z-index: 2;
        }

        .featured-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
            padding: 24px 16px 16px;
        }

        .featured-price {
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
        }

        .featured-title {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.4;
            margin-bottom: 6px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .featured-location {
            font-size: 13px;
            color: #d1d5db;
            margin-bottom: 12px;
        }

        .featured-cta {
            display: inline-block;
            padding: 8px 16px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            color: white;
            font-size: 13px;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .featured-cta:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .featured-thumbnails {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            overflow-x: auto;
            scrollbar-width: thin;
            padding-bottom: 8px;
        }

        .featured-thumbnails::-webkit-scrollbar {
            height: 6px;
        }

        .featured-thumbnails::-webkit-scrollbar-track {
            background: #2a2a2a;
            border-radius: 3px;
        }

        .featured-thumbnails::-webkit-scrollbar-thumb {
            background: #4a4a4a;
            border-radius: 3px;
        }

        .featured-thumbnail {
            flex-shrink: 0;
            width: 120px;
            height: 68px;
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            opacity: 0.6;
        }

        .featured-thumbnail:hover {
            opacity: 0.8;
        }

        .featured-thumbnail.active {
            border-color: var(--color-primary);
            opacity: 1;
        }

        .featured-thumbnail-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .featured-thumbnail-placeholder {
            width: 100%;
            height: 100%;
            background-color: #2a2a2a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
    </style>
</head>

<body>
    <!-- Mobile Sticky Header -->
    <div class="mobile-sticky-header">
        <!-- Sticky Navbar -->
        <nav class="navbar-sticky">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <img src="logo&fav.png" alt="BaLapak Logo" class="h-12 w-auto">
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900">BaLapak</h1>
                            <p class="text-sm text-gray-600">Lapak Lokal Urang Banua</p>
                        </div>
                    </div>
                    <div id="categoryFilterNav" class="hidden md:flex gap-2">
                        <!-- Filters will be injected here -->
                    </div>
                </div>
            </div>
        </nav>

        <!-- Mobile Sticky Search (visible only in list view) -->
        <div id="mobileSearch" class="md:hidden bg-white px-4 pb-4">
            <div class="search-filter-container">
                <input type="text" id="searchInputMobile" class="search-input"
                    placeholder="ðŸ” Cari produk, lokasi, atau kategori..." oninput="handleSearch()">
                <button class="btn-filter-icon" onclick="openFilterModal()">
                    <span>â˜°</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Featured Products Section -->
    <div id="featuredSection" class="featured-section" style="display: none;">
        <div class="featured-container">
            <div class="featured-hero" id="featuredHero" onclick="goToFeaturedDetail()">
                <!-- Featured hero will be injected -->
            </div>
            <div class="featured-thumbnails" id="featuredThumbnails">
                <!-- Featured thumbnails will be injected -->
            </div>
        </div>
    </div>

    <!-- Main Content Container -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- List View Container -->
        <div id="listView" class="fade-in">
            <!-- Category Filters (Mobile) -->
            <div class="md:hidden mb-6">
                <div id="categoryFilterMobile" class="flex flex-wrap gap-2">
                    <!-- Filters will be injected here -->
                </div>
            </div>

            <!-- Search Bar + Filter (Desktop) -->
            <div class="hidden md:block mb-6">
                <div class="search-filter-container">
                    <input type="text" id="searchInput" class="search-input"
                        placeholder="ðŸ” Cari produk, lokasi, atau kategori..." oninput="handleSearch()">
                    <button class="btn-filter-icon" onclick="openFilterModal()">
                        <span>â˜°</span>
                    </button>
                </div>
                <!-- Filter Chips -->
                <div id="filterChips" class="filter-chips-container">
                    <!-- Active filter chips will be injected here -->
                </div>
            </div>

            <!-- Products Grid -->
            <div id="productsGrid" class="masonry-grid">
                <!-- Product cards will be injected here -->
            </div>
        </div>

        <!-- Detail View Container -->
        <div id="detailView" class="fade-in hidden">
            <!-- Product detail will be injected here -->
        </div>
    </main>

    <!-- Filter Modal / Bottom Sheet -->
    <div class="filter-backdrop" id="filterBackdrop" onclick="closeFilterModal()"></div>
    <div class="filter-modal" id="filterModal">
        <div class="filter-modal-header">
            <h2 class="text-lg font-bold">Filter Produk</h2>
            <button onclick="closeFilterModal()" class="text-2xl text-gray-400 hover:text-gray-600">&times;</button>
        </div>
        <div class="filter-modal-content">
            <!-- Price Filter Section -->
            <div class="filter-section">
                <div class="filter-section-title">Harga</div>
                <div class="filter-price-inputs">
                    <input type="number" id="tempMinPrice" class="filter-price-input" placeholder="Harga Min">
                    <span>-</span>
                    <input type="number" id="tempMaxPrice" class="filter-price-input" placeholder="Harga Max">
                </div>
                <div id="priceError" class="filter-error" style="display: none;"></div>
            </div>
            <!-- City Filter Section -->
            <div class="filter-section">
                <div class="filter-section-title">Kota</div>
                <div id="tempCityOptions">
                    <!-- City checkboxes will be injected -->
                </div>
            </div>
        </div>
        <div class="filter-modal-footer">
            <button class="btn-reset" onclick="resetTempFilters()">Reset</button>
            <button class="btn-apply" onclick="applyFilters()">Terapkan</button>
        </div>
    </div>

    <script>
        // ========== PRODUCT DATA ==========
        const PRODUCTS = [
            // Barang Bekas - Kabupaten Balangan
            {
                id: "bb-motor-balangan-01",
                title: "Motor Honda Beat 2018 - Mulus Siap Pakai",
                price: "Rp 7.500.000",
                category: "barang-bekas",
                subcategory: "Motor",
                location: "Kabupaten Balangan",
                description: "Motor Honda Beat tahun 2018, warna hitam, kondisi mulus terawat. Surat lengkap STNK BPKB. Mesin halus, tidak ada PR. Pajak hidup. Cocok untuk harian.",
                whatsapp: "6285123456789",
                featured: true,
                images: [
                    "/home/asyjim/.gemini/antigravity/brain/9f21aac4-5ed3-4dae-a48d-5fe345994e3d/motor_demo_1_1768368969708.png",
                    "/home/asyjim/.gemini/antigravity/brain/9f21aac4-5ed3-4dae-a48d-5fe345994e3d/motor_demo_2_1768369030206.png",
                    "/home/asyjim/.gemini/antigravity/brain/9f21aac4-5ed3-4dae-a48d-5fe345994e3d/motor_demo_3_1768369052673.png"
                ]
            },
            {
                id: "bb-kulkas-balangan-02",
                title: "Kulkas 2 Pintu Samsung 300L",
                price: "Rp 1.800.000",
                category: "barang-bekas",
                subcategory: "Elektronik",
                location: "Kabupaten Balangan",
                description: "Kulkas Samsung 2 pintu kapasitas 300 liter. Kondisi normal dingin. Baru pakai 3 tahun. Masih bagus dan berfungsi dengan baik.",
                whatsapp: "6285123456790",
                images: []
            },

            // Barang Bekas - Kabupaten Banjar
            {
                id: "bb-laptop-banjar-01",
                title: "Laptop ASUS VivoBook Ryzen 5 RAM 8GB",
                price: "Rp 4.200.000",
                category: "barang-bekas",
                subcategory: "Gadget",
                location: "Kabupaten Banjar",
                description: "Laptop ASUS VivoBook Ryzen 5 3500U, RAM 8GB, SSD 256GB, VGA Radeon. Kondisi 90% mulus. Cocok untuk kerja dan kuliah. Baterai awet 4-5 jam.",
                whatsapp: "6285234567891",
                images: []
            },
            {
                id: "bb-meja-banjar-02",
                title: "Meja Belajar Kayu Jati Solid",
                price: "Rp 850.000",
                category: "barang-bekas",
                subcategory: "Furniture",
                location: "Kabupaten Banjar",
                description: "Meja belajar kayu jati solid ukuran 120x60 cm. Kondisi bagus, kokoh. Ada laci untuk penyimpanan. Cocok untuk ruang belajar atau kantor.",
                whatsapp: "6285234567892",
                images: []
            },

            // Barang Bekas - Kabupaten Barito Kuala
            {
                id: "bb-ac-barito-01",
                title: "AC LG 1 PK Low Watt - Dingin Mantap",
                price: "Rp 1.500.000",
                category: "barang-bekas",
                subcategory: "Elektronik",
                location: "Kabupaten Barito Kuala",
                description: "AC LG 1 PK low watt. Dingin normal tidak ada masalah. Sudah termasuk bongkar pasang. Hemat listrik cocok untuk kamar tidur.",
                whatsapp: "6285345678901",
                images: []
            },
            {
                id: "bb-hp-barito-02",
                title: "HP Samsung A52 8/128 GB Fullset",
                price: "Rp 2.900.000",
                category: "barang-bekas",
                subcategory: "Gadget",
                location: "Kabupaten Barito Kuala",
                description: "Samsung Galaxy A52 RAM 8GB ROM 128GB. Kondisi mulus 95% seperti baru. Fullset dus charger. Baterai sehat. Tidak ada minus.",
                whatsapp: "6285345678902",
                images: []
            },

            // Barang Bekas - Kabupaten Hulu Sungai Selatan
            {
                id: "bb-sepeda-hss-01",
                title: "Sepeda MTB Polygon 27.5 inch",
                price: "Rp 2.100.000",
                category: "barang-bekas",
                subcategory: "Olahraga",
                location: "Kabupaten Hulu Sungai Selatan",
                description: "Sepeda gunung Polygon ukuran 27.5 inch. Kondisi normal siap pakai. Sudah upgrade fork dan gear Shimano. Cocok untuk adventure.",
                whatsapp: "6285456789012",
                images: []
            },

            // Barang Bekas - Kabupaten Hulu Sungai Tengah
            {
                id: "bb-tv-hst-01",
                title: "TV LED Samsung 43 inch Smart TV",
                price: "Rp 2.500.000",
                category: "barang-bekas",
                subcategory: "Elektronik",
                location: "Kabupaten Hulu Sungai Tengah",
                description: "TV LED Samsung 43 inch Smart TV. Bisa Netflix, YouTube. Kondisi normal tidak ada garis. Remote lengkap. Jernih gambarnya.",
                whatsapp: "6285567890123",
                images: []
            },

            // Barang Bekas - Kabupaten Hulu Sungai Utara
            {
                id: "bb-sofa-hsu-01",
                title: "Sofa L Minimalis Cream - 5 Dudukan",
                price: "Rp 3.200.000",
                category: "barang-bekas",
                subcategory: "Furniture",
                location: "Kabupaten Hulu Sungai Utara",
                description: "Sofa L minimalis warna cream untuk 5 dudukan. Kondisi bersih terawat. Busa masih empuk. Cocok untuk ruang tamu modern.",
                whatsapp: "6285678901234",
                images: []
            },

            // Barang Bekas - Kabupaten Kotabaru
            {
                id: "bb-mesin-cuci-kotabaru-01",
                title: "Mesin Cuci Sharp 2 Tabung 8 Kg",
                price: "Rp 1.100.000",
                category: "barang-bekas",
                subcategory: "Elektronik",
                location: "Kabupaten Kotabaru",
                description: "Mesin cuci Sharp 2 tabung kapasitas 8 kg. Kondisi normal berfungsi baik. Cuci kering lancar. Hemat air dan listrik.",
                whatsapp: "6285789012345",
                images: []
            },

            // Barang Bekas - Kabupaten Tabalong
            {
                id: "bb-kompor-tabalong-01",
                title: "Kompor Gas Rinnai 2 Tungku + Tabung",
                price: "Rp 650.000",
                category: "barang-bekas",
                subcategory: "Dapur",
                location: "Kabupaten Tabalong",
                description: "Kompor gas Rinnai 2 tungku masih bagus. Api biru merata. Bonus tabung gas 3kg. Kondisi bersih siap pakai.",
                whatsapp: "6285890123456",
                images: []
            },

            // Barang Bekas - Kabupaten Tanah Bumbu
            {
                id: "bb-playstation-tbu-01",
                title: "PlayStation 4 Slim 500GB + 2 Stik",
                price: "Rp 2.800.000",
                category: "barang-bekas",
                subcategory: "Gadget",
                location: "Kabupaten Tanah Bumbu",
                description: "PS4 Slim 500GB CFW. 2 stik original. Bonus 20 game. Kondisi normal lancar. Lengkap kabel HDMI dan power.",
                whatsapp: "6285901234567",
                images: []
            },

            // Barang Bekas - Kabupaten Tanah Laut
            {
                id: "bb-kasur-tlaut-01",
                title: "Kasur Spring Bed King Koil 160x200",
                price: "Rp 2.500.000",
                category: "barang-bekas",
                subcategory: "Furniture",
                location: "Kabupaten Tanah Laut",
                description: "Kasur spring bed King Koil ukuran 160x200 cm. Kondisi masih bagus empuk. Tidak ada yang kempes. Cocok untuk kamar utama.",
                whatsapp: "6281234567890",
                images: []
            },

            // Barang Bekas - Kabupaten Tapin
            {
                id: "bb-printer-tapin-01",
                title: "Printer Canon Pixma G2010 Infus",
                price: "Rp 1.300.000",
                category: "barang-bekas",
                subcategory: "Elektronik",
                location: "Kabupaten Tapin",
                description: "Printer Canon G2010 sistem infus. Print scan copy. Kondisi normal lancar. Hemat tinta. Cocok untuk usaha fotocopy atau rumahan.",
                whatsapp: "6281234567891",
                images: []
            },

            // Sewa Hunian - Banjarmasin
            {
                id: "sh-kost-bjm-01",
                title: "Kost Putri AC + Wifi - Dekat UNLAM",
                price: "Rp 800.000/bulan",
                category: "sewa-hunian",
                subcategory: "Kost",
                location: "Banjarmasin",
                description: "Kost putri bersih dan aman. Fasilitas: AC, WiFi, kamar mandi dalam, kasur, lemari. Lokasi strategis dekat kampus UNLAM dan pusat kota. Listrik token. Dapur bersama.",
                whatsapp: "6282123456789",
                images: []
            },
            {
                id: "sh-kost-bjm-02",
                title: "Kost Putra Eksklusif - Full Furnished",
                price: "Rp 1.200.000/bulan",
                category: "sewa-hunian",
                subcategory: "Kost",
                location: "Banjarmasin",
                description: "Kost putra eksklusif full furnished. Fasilitas lengkap: AC, WiFi unlimited, TV, kamar mandi dalam, water heater, spring bed, meja belajar. Area parkir luas. CCTV 24 jam.",
                whatsapp: "6282123456790",
                images: []
            },
            {
                id: "sh-rumah-bjm-01",
                title: "Rumah 2 Kamar Tidur - Komplex Asri",
                price: "Rp 15.000.000/tahun",
                category: "sewa-hunian",
                subcategory: "Rumah",
                location: "Banjarmasin",
                description: "Rumah minimalis 2 kamar tidur di komplek perumahan asri. Luas tanah 6x12 m. Listrik 1300 watt. Air PDAM. Carport 1 mobil. Dekat sekolah dan pasar.",
                whatsapp: "6282234567891",
                images: []
            },
            {
                id: "sh-kontrakan-bjm-01",
                title: "Kontrakan Keluarga 3 Kamar - Tepi Jalan",
                price: "Rp 20.000.000/tahun",
                category: "sewa-hunian",
                subcategory: "Rumah",
                location: "Banjarmasin",
                description: "Kontrakan untuk keluarga 3 kamar tidur, 2 kamar mandi. Lokasi strategis tepi jalan raya. Listrik 2200 watt. Sumur bor + PDAM. Ruang tamu luas. Cocok untuk usaha juga.",
                whatsapp: "6282234567892",
                images: []
            },

            // Sewa Hunian - Banjarbaru
            {
                id: "sh-kost-bbaru-01",
                title: "Kost Campur AC - Area Kampus ULM",
                price: "Rp 700.000/bulan",
                category: "sewa-hunian",
                subcategory: "Kost",
                location: "Banjarbaru",
                description: "Kost campur nyaman dekat kampus ULM Banjarbaru. Fasilitas: AC, WiFi, kasur, lemari. Kamar mandi luar. Dapur umum. Parkir motor gratis. Lingkungan aman dan tenang.",
                whatsapp: "6282345678901",
                images: []
            },
            {
                id: "sh-rumah-bbaru-01",
                title: "Rumah Minimalis 2 Lantai - 3 Kamar",
                price: "Rp 25.000.000/tahun",
                category: "sewa-hunian",
                subcategory: "Rumah",
                location: "Banjarbaru",
                description: "Rumah 2 lantai modern di Banjarbaru. 3 kamar tidur, 2 kamar mandi. Listrik 2200W. Carport 2 mobil. Taman depan. Dekat dengan plaza dan sekolah. Cocok untuk keluarga.",
                whatsapp: "6282345678902",
                images: []
            },
            {
                id: "sh-apartemen-bbaru-01",
                title: "Apartemen Studio Full Furnished - CBD",
                price: "Rp 2.500.000/bulan",
                category: "sewa-hunian",
                subcategory: "Apartemen",
                location: "Banjarbaru",
                description: "Apartemen studio full furnished di pusat kota Banjarbaru. Fasilitas: AC, TV, kulkas, spring bed, kitchen set. Akses kolam renang, gym, laundry. Keamanan 24 jam. View kota.",
                whatsapp: "6282456789012",
                images: []
            }
        ];

        // ========== UTILITY FUNCTIONS ==========

        // Get URL parameter
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Set URL parameter without reload
        function setUrlParameter(name, value) {
            const url = new URL(window.location);
            if (value) {
                url.searchParams.set(name, value);
            } else {
                url.searchParams.delete(name);
            }
            window.history.pushState({}, '', url);
        }

        // Format WhatsApp URL
        function getWhatsAppUrl(phone, productTitle) {
            const message = `Halo, saya tertarik dengan produk: ${productTitle}`;
            return `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
        }

        // Get unique categories
        function getCategories() {
            const categories = ['semua', ...new Set(PRODUCTS.map(p => p.category))];
            return categories;
        }

        // Get unique cities
        function getCities() {
            const cities = [...new Set(PRODUCTS.map(p => p.location))].sort();
            return cities;
        }

        // Price range definitions
        const PRICE_RANGES = [
            { id: 'under1m', label: '< 1 jt', min: 0, max: 1000000 },
            { id: '1to3m', label: '1-3 jt', min: 1000000, max: 3000000 },
            { id: '3to5m', label: '3-5 jt', min: 3000000, max: 5000000 },
            { id: 'over5m', label: '> 5 jt', min: 5000000, max: Infinity }
        ];

        // Active filters state
        let activeFilters = {
            minPrice: null,
            maxPrice: null,
            cities: []
        };

        // Temporary filters (while modal is open)
        let tempFilters = {
            minPrice: null,
            maxPrice: null,
            cities: []
        };

        // Open filter modal
        function openFilterModal() {
            // Copy active filters to temp
            tempFilters.minPrice = activeFilters.minPrice;
            tempFilters.maxPrice = activeFilters.maxPrice;
            tempFilters.cities = [...activeFilters.cities];

            // Render filter options
            renderTempFilterOptions();

            // Show modal
            document.getElementById('filterBackdrop').classList.add('active');
            document.getElementById('filterModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close filter modal
        function closeFilterModal() {
            document.getElementById('filterBackdrop').classList.remove('active');
            document.getElementById('filterModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        // Render temp filter options
        function renderTempFilterOptions() {
            // Set price inputs
            const minPriceInput = document.getElementById('tempMinPrice');
            const maxPriceInput = document.getElementById('tempMaxPrice');
            if (minPriceInput) minPriceInput.value = tempFilters.minPrice || '';
            if (maxPriceInput) maxPriceInput.value = tempFilters.maxPrice || '';

            // Hide error
            const priceError = document.getElementById('priceError');
            if (priceError) priceError.style.display = 'none';

            // Render city checkboxes
            const cities = getCities();
            const cityContainer = document.getElementById('tempCityOptions');
            if (cityContainer) {
                const cityHTML = cities.map(city => {
                    const isChecked = tempFilters.cities.includes(city);
                    const activeClass = isChecked ? 'active' : '';
                    return `
                        <label class="filter-checkbox-item ${activeClass}" onclick="toggleTempCity('${city}')">
                            <input type="checkbox" class="filter-checkbox" ${isChecked ? 'checked' : ''} onchange="event.stopPropagation(); toggleTempCity('${city}')">
                            <span>${city}</span>
                        </label>
                    `;
                }).join('');
                cityContainer.innerHTML = cityHTML;
            }
        }

        // Toggle temp city filter
        function toggleTempCity(city) {
            const index = tempFilters.cities.indexOf(city);
            if (index > -1) {
                tempFilters.cities.splice(index, 1);
            } else {
                tempFilters.cities.push(city);
            }
            renderTempFilterOptions();
        }

        // Reset temp filters
        function resetTempFilters() {
            tempFilters.minPrice = null;
            tempFilters.maxPrice = null;
            tempFilters.cities = [];
            renderTempFilterOptions();
        }

        // Validate price inputs
        function validatePriceInputs() {
            const minPriceInput = document.getElementById('tempMinPrice');
            const maxPriceInput = document.getElementById('tempMaxPrice');
            const priceError = document.getElementById('priceError');

            const minPrice = minPriceInput ? parseInt(minPriceInput.value) : null;
            const maxPrice = maxPriceInput ? parseInt(maxPriceInput.value) : null;

            if (minPrice && maxPrice && minPrice > maxPrice) {
                if (priceError) {
                    priceError.textContent = 'Harga minimum tidak boleh lebih besar dari harga maksimum';
                    priceError.style.display = 'block';
                }
                return false;
            }

            if (priceError) {
                priceError.style.display = 'none';
            }
            return true;
        }

        // Apply filters
        function applyFilters() {
            // Validate price inputs
            if (!validatePriceInputs()) {
                return;
            }

            // Get price values from inputs
            const minPriceInput = document.getElementById('tempMinPrice');
            const maxPriceInput = document.getElementById('tempMaxPrice');

            activeFilters.minPrice = minPriceInput && minPriceInput.value ? parseInt(minPriceInput.value) : null;
            activeFilters.maxPrice = maxPriceInput && maxPriceInput.value ? parseInt(maxPriceInput.value) : null;
            activeFilters.cities = [...tempFilters.cities];

            closeFilterModal();
            renderListView();
        }

        // Render price filter buttons (deprecated)
        function renderPriceFilterButtons() {
            // No longer needed with modal-based filters
        }

        // Render city filter buttons (deprecated)
        function renderCityFilterButtons() {
            // No longer needed with modal-based filters
        }

        // Toggle price filter (deprecated)
        function togglePriceFilter(rangeId) {
            // No longer needed with modal-based filters
        }

        // Toggle city filter (deprecated)
        function toggleCityFilter(city) {
            // No longer needed with modal-based filters
        }

        // ========== RENDER FUNCTIONS ==========

        // Render category filters
        function renderCategoryFilters() {
            const categories = getCategories();
            const currentCategory = getUrlParameter('category') || 'semua';

            const filterHTML = categories.map(cat => {
                const label = cat === 'semua' ? 'Semua' :
                    cat === 'barang-bekas' ? 'Barang Bekas' :
                        'Sewa Hunian';
                const activeClass = cat === currentCategory ? 'active' : '';
                return `<button class="filter-btn ${activeClass}" onclick="filterByCategory('${cat}')">${label}</button>`;
            }).join('');

            document.getElementById('categoryFilterNav').innerHTML = filterHTML;
            document.getElementById('categoryFilterMobile').innerHTML = filterHTML;
        }

        // Filter products by category
        function filterByCategory(category) {
            setUrlParameter('category', category === 'semua' ? null : category);
            renderListView();
        }

        // Handle search input
        function handleSearch() {
            // Auto-reset filters when user starts typing
            const searchInput = document.getElementById('searchInput');
            const searchInputMobile = document.getElementById('searchInputMobile');
            const searchQuery = searchInput?.value || searchInputMobile?.value || '';

            if (searchQuery.trim()) {
                // Reset all filters if user is searching
                if (activeFilters.minPrice || activeFilters.maxPrice || activeFilters.cities.length > 0) {
                    activeFilters.minPrice = null;
                    activeFilters.maxPrice = null;
                    activeFilters.cities = [];
                }
            }

            renderListView();
        }

        // Render filter chips
        function renderFilterChips() {
            const container = document.getElementById('filterChips');
            if (!container) return;

            const chips = [];

            // Price filter chip
            if (activeFilters.minPrice || activeFilters.maxPrice) {
                let priceLabel = 'Harga: ';
                if (activeFilters.minPrice && activeFilters.maxPrice) {
                    priceLabel += `Rp ${activeFilters.minPrice.toLocaleString()} - Rp ${activeFilters.maxPrice.toLocaleString()}`;
                } else if (activeFilters.minPrice) {
                    priceLabel += `> Rp ${activeFilters.minPrice.toLocaleString()}`;
                } else {
                    priceLabel += `< Rp ${activeFilters.maxPrice.toLocaleString()}`;
                }
                chips.push(`
                    <div class="filter-chip">
                        <span>${priceLabel}</span>
                        <span class="filter-chip-close" onclick="removePriceFilter()">\u00d7</span>
                    </div>
                `);
            }

            // City filter chips
            activeFilters.cities.forEach(city => {
                chips.push(`
                    <div class="filter-chip">
                        <span>${city}</span>
                        <span class="filter-chip-close" onclick="removeCityFilter('${city}')">\u00d7</span>
                    </div>
                `);
            });

            // Reset all button
            if (chips.length > 1) {
                chips.push(`
                    <button class="filter-chip-reset" onclick="resetAllFilters()">
                        Reset Semua
                    </button>
                `);
            }

            container.innerHTML = chips.join('');
        }

        // Remove price filter
        function removePriceFilter() {
            activeFilters.minPrice = null;
            activeFilters.maxPrice = null;
            renderListView();
        }

        // Remove city filter
        function removeCityFilter(city) {
            const index = activeFilters.cities.indexOf(city);
            if (index > -1) {
                activeFilters.cities.splice(index, 1);
            }
            renderListView();
        }

        // Reset all filters
        function resetAllFilters() {
            activeFilters.minPrice = null;
            activeFilters.maxPrice = null;
            activeFilters.cities = [];
            renderListView();
        }

        // Get price filters
        function getPriceFilters() {
            return {
                min: activeFilters.minPrice || 0,
                max: activeFilters.maxPrice || Infinity
            };
        }

        // Get city filter
        function getCityFilter() {
            return activeFilters.cities;
        }

        // Extract numeric price from price string
        function extractPrice(priceStr) {
            const match = priceStr.replace(/[^0-9]/g, '');
            return parseInt(match) || 0;
        }

        // Filter products by price
        function filterProductsByPrice(products, minPrice, maxPrice) {
            if (minPrice === 0 && maxPrice === Infinity) return products;

            return products.filter(product => {
                const price = extractPrice(product.price);
                return price >= minPrice && price <= maxPrice;
            });
        }

        // Filter products by city
        function filterProductsByCity(products, cities) {
            if (!cities || cities.length === 0) return products;
            return products.filter(product => cities.includes(product.location));
        }

        // Get search query
        function getSearchQuery() {
            const searchInput = document.getElementById('searchInput');
            const searchInputMobile = document.getElementById('searchInputMobile');
            const desktopValue = searchInput ? searchInput.value.toLowerCase().trim() : '';
            const mobileValue = searchInputMobile ? searchInputMobile.value.toLowerCase().trim() : '';
            return desktopValue || mobileValue;
        }

        // Filter products by search query
        function filterProductsBySearch(products, query) {
            if (!query) return products;

            return products.filter(product => {
                const searchText = `${product.title} ${product.location} ${product.category} ${product.subcategory || ''}`.toLowerCase();
                return searchText.includes(query);
            });
        }

        // Render product card
        function renderProductCard(product) {
            const hasImage = product.images && product.images.length > 0;
            const imageHTML = hasImage
                ? `<img src="${product.images[0]}" alt="${product.title}" class="product-card-image">`
                : `<div class="product-card-placeholder">ðŸ“¦</div>`;

            return `
                <div class="product-card" onclick="showDetail('${product.id}')">
                    ${imageHTML}
                    <div class="product-card-content">
                        <div class="price-tag">${product.price}</div>
                        <h3 class="text-sm font-semibold mt-2 text-gray-900 leading-tight line-clamp-2">${product.title}</h3>
                    </div>
                </div>
            `;
        }

        // Render list view
        function renderListView() {
            const currentCategory = getUrlParameter('category') || 'semua';
            const searchQuery = getSearchQuery();
            const priceFilters = getPriceFilters();
            const cityFilter = getCityFilter();

            let filteredProducts = currentCategory === 'semua'
                ? PRODUCTS
                : PRODUCTS.filter(p => p.category === currentCategory);

            filteredProducts = filterProductsBySearch(filteredProducts, searchQuery);
            filteredProducts = filterProductsByPrice(filteredProducts, priceFilters.min, priceFilters.max);
            filteredProducts = filterProductsByCity(filteredProducts, cityFilter);

            const productsHTML = filteredProducts.length > 0
                ? filteredProducts.map(renderProductCard).join('')
                : '<div class="text-center py-12 text-gray-500 w-full" style="column-span: all;"><p class="text-lg">Tidak ada produk yang ditemukan</p><p class="text-sm mt-2">Coba ubah kata kunci pencarian Anda</p></div>';

            document.getElementById('productsGrid').innerHTML = productsHTML;

            renderCategoryFilters();
            renderFilterChips();
        }

        // Render detail view
        function renderDetailView(productId) {
            const product = PRODUCTS.find(p => p.id === productId);

            if (!product) {
                document.getElementById('detailView').innerHTML = `
                    <div class="text-center py-12">
                        <h2 class="text-2xl font-bold mb-4">Produk tidak ditemukan</h2>
                        <button onclick="showList()" class="btn-secondary">Kembali ke Daftar</button>
                    </div>
                `;
                return;
            }

            const imagesHTML = product.images && product.images.length > 0
                ? `<div class="image-gallery">
                     <img id="mainImage" src="${product.images[0]}" alt="${product.title}" class="main-image">
                     ${product.images.length > 1 ? `
                       <div class="thumbnail-grid">
                         ${product.images.map((img, index) => `
                           <img src="${img}" 
                                alt="${product.title} ${index + 1}" 
                                class="thumbnail ${index === 0 ? 'active' : ''}" 
                                onclick="changeMainImage('${img}', this)"
                           >
                         `).join('')}
                       </div>
                     ` : ''}
                   </div>`
                : '';

            const detailHTML = `
                <div class="max-w-3xl mx-auto">
                    <button onclick="showList()" class="btn-secondary mb-6">
                        â† Kembali ke Daftar
                    </button>
                    
                    <div class="bg-white border border-gray-200 rounded-lg p-6 md:p-8">
                        <div class="mb-4">
                            <span class="tag">${product.subcategory || product.category}</span>
                            <span class="tag ml-2">ðŸ“ ${product.location}</span>
                        </div>
                        
                        <h1 class="text-3xl font-bold mb-4 text-gray-900">${product.title}</h1>
                        <div class="price-tag mb-6">${product.price}</div>
                        
                        ${imagesHTML}
                        
                        <div class="mb-6">
                            <h2 class="text-xl font-semibold mb-3">Deskripsi</h2>
                            <p class="text-gray-700 leading-relaxed">${product.description}</p>
                        </div>
                        
                        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                            <h2 class="text-xl font-semibold mb-2">Lokasi</h2>
                            <p class="text-gray-700">ðŸ“ ${product.location}, Kalimantan Selatan</p>
                        </div>
                        
                        <div class="text-center pt-4">
                            <a href="${getWhatsAppUrl(product.whatsapp, product.title)}" 
                               target="_blank"
                               class="btn-primary text-lg px-8 py-4">
                                ðŸ’¬ Hubungi via WhatsApp
                            </a>
                            <p class="text-sm text-gray-500 mt-3">Klik tombol di atas untuk menghubungi penjual</p>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('detailView').innerHTML = detailHTML;
        }

        // ========== NAVIGATION FUNCTIONS ==========

        // Change main image in detail view
        function changeMainImage(imageSrc, thumbnailElement) {
            document.getElementById('mainImage').src = imageSrc;

            // Remove active class from all thumbnails
            document.querySelectorAll('.thumbnail').forEach(thumb => {
                thumb.classList.remove('active');
            });

            // Add active class to clicked thumbnail
            thumbnailElement.classList.add('active');
        }

        // Show detail page
        function showDetail(productId) {
            setUrlParameter('id', productId);
            document.getElementById('listView').classList.add('hidden');
            document.getElementById('detailView').classList.remove('hidden');
            renderDetailView(productId);
            window.scrollTo(0, 0);
        }

        // Show list page
        function showList() {
            setUrlParameter('id', null);
            document.getElementById('detailView').classList.add('hidden');
            document.getElementById('listView').classList.remove('hidden');
            renderListView();
            window.scrollTo(0, 0);
        }

        // ========== FEATURED SECTION ==========

        let featuredProducts = [];
        let currentFeaturedIndex = 0;

        // Get featured products
        function getFeaturedProducts() {
            return PRODUCTS.filter(p => p.featured && p.images && p.images.length > 0).slice(0, 8);
        }

        // Render featured section
        function renderFeaturedSection() {
            featuredProducts = getFeaturedProducts();

            const section = document.getElementById('featuredSection');
            if (!section) return;

            if (featuredProducts.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            currentFeaturedIndex = 0;
            renderFeaturedHero();
            renderFeaturedThumbnails();
        }

        // Render featured hero
        function renderFeaturedHero() {
            const hero = document.getElementById('featuredHero');
            if (!hero || featuredProducts.length === 0) return;

            const product = featuredProducts[currentFeaturedIndex];
            const hasImage = product.images && product.images.length > 0;
            const imageHTML = hasImage
                ? `<img src="${product.images[0]}" alt="${product.title}" class="featured-hero-image" loading="lazy">`
                : `<div class="featured-hero-placeholder">ðŸ“¦</div>`;

            hero.innerHTML = `
                ${imageHTML}
                <div class="featured-badge">Rekomendasi</div>
                <div class="featured-overlay">
                    <div class="featured-price">${product.price}</div>
                    <div class="featured-title">${product.title}</div>
                    <div class="featured-location">ðŸ“ ${product.location}</div>
                    <a href="${getWhatsAppUrl(product.whatsapp, product.title)}" target="_blank" class="featured-cta" onclick="event.stopPropagation()">
                        ðŸ’¬ Hubungi Penjual
                    </a>
                </div>
            `;
        }

        // Render featured thumbnails
        function renderFeaturedThumbnails() {
            const container = document.getElementById('featuredThumbnails');
            if (!container || featuredProducts.length === 0) return;

            const thumbnailsHTML = featuredProducts.map((product, index) => {
                const hasImage = product.images && product.images.length > 0;
                const imageHTML = hasImage
                    ? `<img src="${product.images[0]}" alt="${product.title}" class="featured-thumbnail-image" loading="lazy">`
                    : `<div class="featured-thumbnail-placeholder">ðŸ“¦</div>`;
                const activeClass = index === currentFeaturedIndex ? 'active' : '';

                return `
                    <div class="featured-thumbnail ${activeClass}" onclick="setFeaturedIndex(${index})">
                        ${imageHTML}
                    </div>
                `;
            }).join('');

            container.innerHTML = thumbnailsHTML;
        }

        // Set featured index
        function setFeaturedIndex(index) {
            if (index >= 0 && index < featuredProducts.length) {
                currentFeaturedIndex = index;
                renderFeaturedHero();
                renderFeaturedThumbnails();
            }
        }

        // Go to featured detail
        function goToFeaturedDetail() {
            if (featuredProducts.length > 0) {
                const product = featuredProducts[currentFeaturedIndex];
                showDetail(product.id);
            }
        }

        // ========== INIT ==========

        // Initialize app based on URL
        function initApp() {
            const productId = getUrlParameter('id');

            if (productId) {
                showDetail(productId);
            } else {
                showList();
            }

            // Render featured section only in list view
            if (!productId) {
                renderFeaturedSection();
            }
        }

        // Handle browser back/forward
        window.addEventListener('popstate', initApp);

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>

</html>